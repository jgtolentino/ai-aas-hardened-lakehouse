-- SQL dump generated using DBML (dbml.dbdiagram.io)
-- Database: PostgreSQL
-- Generated at: 2025-08-23T04:05:25.703Z

CREATE SCHEMA "scout";

CREATE TYPE "transaction_status" AS ENUM (
  'pending',
  'completed',
  'cancelled',
  'failed'
);

CREATE TYPE "price_tier" AS ENUM (
  'value',
  'standard',
  'premium'
);

CREATE TYPE "customer_segment" AS ENUM (
  'premium',
  'regular',
  'occasional',
  'churned'
);

CREATE TYPE "request_type" AS ENUM (
  'branded',
  'unbranded',
  'unsure'
);

CREATE TYPE "geom_type" AS ENUM (
  'region',
  'province',
  'city',
  'barangay',
  'custom'
);

CREATE TABLE "scout"."dim_date" (
  "date_key" integer PRIMARY KEY,
  "full_date" date UNIQUE NOT NULL,
  "year" integer NOT NULL,
  "quarter" integer NOT NULL,
  "month" integer NOT NULL,
  "month_name" varchar NOT NULL,
  "month_short" varchar(3) NOT NULL,
  "week_of_year" integer NOT NULL,
  "day_of_month" integer NOT NULL,
  "day_of_week" integer NOT NULL,
  "day_name" varchar NOT NULL,
  "day_short" varchar(3) NOT NULL,
  "is_weekend" boolean NOT NULL,
  "is_holiday" boolean DEFAULT false,
  "holiday_name" varchar,
  "fiscal_year" integer,
  "fiscal_quarter" integer,
  "fiscal_month" integer
);

CREATE TABLE "scout"."dim_time" (
  "time_key" integer PRIMARY KEY,
  "full_time" time UNIQUE NOT NULL,
  "hour" integer NOT NULL,
  "minute" integer NOT NULL,
  "second" integer NOT NULL,
  "hour_12" integer NOT NULL,
  "am_pm" varchar(2) NOT NULL,
  "time_of_day" varchar NOT NULL,
  "business_hours" boolean NOT NULL,
  "peak_hours" boolean NOT NULL
);

CREATE TABLE "scout"."dim_stores" (
  "store_key" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "store_id" varchar UNIQUE NOT NULL,
  "store_name" varchar,
  "store_type" varchar,
  "barangay" varchar,
  "city" varchar,
  "province" varchar,
  "region" varchar,
  "island_group" varchar,
  "store_size" varchar,
  "economic_class" varchar,
  "urban_rural" varchar,
  "date_opened" date,
  "date_closed" date,
  "is_active" boolean DEFAULT true,
  "effective_from" date NOT NULL DEFAULT 'CURRENT_DATE',
  "effective_to" date,
  "is_current" boolean DEFAULT true,
  "district" varchar,
  "operating_hours" varchar,
  "manager_name" varchar,
  "latitude" numeric(10,7),
  "longitude" numeric(10,7),
  "created_at" timestamp DEFAULT 'now()',
  "updated_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."dim_customers" (
  "customer_key" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "customer_id" varchar UNIQUE NOT NULL,
  "customer_name" varchar,
  "customer_type" varchar,
  "gender" varchar,
  "age_group" varchar,
  "income_bracket" varchar,
  "economic_class" varchar,
  "barangay" varchar,
  "city" varchar,
  "province" varchar,
  "customer_segment" varchar,
  "preferred_payment" varchar,
  "first_purchase_date" date,
  "last_purchase_date" date,
  "effective_from" date NOT NULL DEFAULT 'CURRENT_DATE',
  "effective_to" date,
  "is_current" boolean DEFAULT true,
  "loyalty_tier" varchar DEFAULT 'Bronze',
  "preferred_daypart" varchar,
  "preferred_category" varchar,
  "lifetime_value" numeric(12,2),
  "purchase_frequency" varchar,
  "created_at" timestamp DEFAULT 'now()',
  "updated_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."dim_products" (
  "product_key" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "sku" varchar UNIQUE NOT NULL,
  "product_name" varchar NOT NULL,
  "category" varchar NOT NULL,
  "subcategory" varchar,
  "brand" varchar,
  "manufacturer" varchar,
  "supplier" varchar,
  "unit_cost" numeric(10,2),
  "unit_price" numeric(10,2),
  "price_tier" varchar,
  "package_size" varchar,
  "unit_of_measure" varchar,
  "barcode" varchar,
  "is_active" boolean DEFAULT true,
  "launch_date" date,
  "discontinue_date" date,
  "effective_from" date NOT NULL DEFAULT 'CURRENT_DATE',
  "effective_to" date,
  "is_current" boolean DEFAULT true,
  "created_at" timestamp DEFAULT 'now()',
  "updated_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."dim_campaigns" (
  "campaign_key" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "campaign_id" varchar UNIQUE NOT NULL,
  "campaign_name" varchar NOT NULL,
  "campaign_type" varchar,
  "campaign_category" varchar,
  "start_date" date NOT NULL,
  "end_date" date NOT NULL,
  "budget" numeric(12,2),
  "target_sales" numeric(12,2),
  "discount_rate" numeric(5,2),
  "target_audience" varchar,
  "channel" varchar,
  "status" varchar DEFAULT 'active',
  "created_at" timestamp DEFAULT 'now()',
  "updated_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."dim_payment_methods" (
  "payment_key" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "payment_method" varchar UNIQUE NOT NULL,
  "payment_category" varchar,
  "provider" varchar,
  "transaction_fee_rate" numeric(5,4),
  "is_digital" boolean DEFAULT false,
  "is_active" boolean DEFAULT true,
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."dim_geometries" (
  "geom_key" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "geom_type" varchar NOT NULL,
  "geom_code" varchar UNIQUE NOT NULL,
  "geom_name" varchar NOT NULL,
  "parent_code" varchar,
  "centroid_lat" numeric(10,7),
  "centroid_lng" numeric(10,7),
  "boundary_geojson" jsonb NOT NULL,
  "effective_from" date DEFAULT 'CURRENT_DATE',
  "effective_to" date,
  "is_current" boolean DEFAULT true,
  "created_at" timestamptz DEFAULT 'now()',
  "updated_at" timestamptz DEFAULT 'now()'
);

CREATE TABLE "scout"."fact_transactions" (
  "transaction_id" varchar PRIMARY KEY,
  "store_id" varchar NOT NULL,
  "customer_id" varchar,
  "campaign_id" varchar,
  "transaction_date" date NOT NULL,
  "transaction_time" time NOT NULL,
  "total_amount" numeric(12,2) NOT NULL,
  "discount_amount" numeric(10,2) DEFAULT 0,
  "tax_amount" numeric(10,2),
  "payment_method" varchar,
  "status" varchar NOT NULL,
  "date_key" integer,
  "time_key" integer,
  "store_key" integer,
  "customer_key" integer,
  "campaign_key" integer,
  "payment_key" integer,
  "items" jsonb DEFAULT '[]',
  "transcript" text,
  "brand_detection_status" varchar DEFAULT 'pending',
  "customer_gender" varchar,
  "customer_age_group" varchar,
  "confidence_demographics" numeric(3,2),
  "source_file" text NOT NULL,
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."fact_transaction_items" (
  "transaction_id" varchar NOT NULL,
  "line_item_id" integer NOT NULL,
  "sku" varchar NOT NULL,
  "quantity" integer NOT NULL,
  "unit_price" numeric(10,2) NOT NULL,
  "line_amount" numeric(10,2) NOT NULL,
  "discount_amount" numeric(10,2) DEFAULT 0,
  "product_key" integer,
  "brand_name" varchar,
  "brand_id" integer,
  "category_name" varchar,
  "category_id" integer,
  "detection_method" varchar,
  "confidence" numeric(3,2),
  "source_file" text NOT NULL,
  "created_at" timestamp DEFAULT 'now()',
  PRIMARY KEY ("transaction_id", "line_item_id")
);

CREATE TABLE "scout"."fact_daily_sales" (
  "date_key" integer NOT NULL,
  "store_key" integer NOT NULL,
  "product_key" integer NOT NULL,
  "units_sold" integer DEFAULT 0,
  "revenue" numeric(12,2) DEFAULT 0,
  "discount_amount" numeric(10,2) DEFAULT 0,
  "transaction_count" integer DEFAULT 0,
  "unique_customers" integer DEFAULT 0,
  "avg_unit_price" numeric(10,2),
  "avg_basket_size" numeric(10,2),
  "created_at" timestamp DEFAULT 'now()',
  "updated_at" timestamp DEFAULT 'now()',
  PRIMARY KEY ("date_key", "store_key", "product_key")
);

CREATE TABLE "scout"."fact_consumer_behavior" (
  "behavior_id" bigserial PRIMARY KEY,
  "transaction_id" varchar NOT NULL,
  "customer_id" varchar,
  "store_id" varchar,
  "dwell_time_seconds" integer,
  "items_viewed" integer,
  "items_purchased" integer,
  "conversion_rate" numeric(5,4),
  "repeat_visit_days" integer,
  "shopping_mission" varchar,
  "price_sensitivity_score" numeric(3,2),
  "brand_loyalty_score" numeric(3,2),
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."fact_basket_analysis" (
  "basket_id" bigserial PRIMARY KEY,
  "transaction_id" bigint NOT NULL,
  "product_key" int NOT NULL,
  "co_product_key" int NOT NULL,
  "lift" numeric(12,6),
  "confidence" numeric(12,6),
  "support" numeric(12,6),
  "as_of_date" date NOT NULL
);

CREATE TABLE "scout"."fact_substitutions" (
  "id" bigserial PRIMARY KEY,
  "product_key" int NOT NULL,
  "substitute_key" int NOT NULL,
  "substitution_rate" numeric(12,6),
  "as_of_date" date NOT NULL
);

CREATE TABLE "scout"."fact_request_patterns" (
  "id" bigserial PRIMARY KEY,
  "store_key" int NOT NULL,
  "request_type" varchar NOT NULL,
  "hour_bucket" int NOT NULL,
  "requests_count" int NOT NULL DEFAULT 0,
  "as_of_date" date NOT NULL
);

CREATE TABLE "scout"."fact_transaction_duration" (
  "transaction_id" bigint PRIMARY KEY,
  "store_key" int NOT NULL,
  "started_at" timestamptz NOT NULL,
  "completed_at" timestamptz NOT NULL,
  "duration_seconds" int NOT NULL,
  "as_of_date" date NOT NULL
);

CREATE TABLE "scout"."fact_monthly_performance" (
  "id" bigserial PRIMARY KEY,
  "date_key" int NOT NULL,
  "store_key" int NOT NULL,
  "product_key" int,
  "revenue" numeric(18,2),
  "units" numeric(18,2),
  "margin" numeric(18,2),
  "share" numeric(12,6)
);

CREATE TABLE "scout"."master_brands" (
  "brand_id" integer PRIMARY KEY,
  "brand_code" varchar UNIQUE NOT NULL,
  "brand_name" varchar NOT NULL,
  "brand_tier" varchar,
  "is_local" boolean DEFAULT false,
  "is_tbwa_client" boolean DEFAULT false,
  "parent_company" varchar,
  "country_origin" varchar,
  "is_active" boolean DEFAULT true,
  "created_at" timestamp DEFAULT 'now()',
  "updated_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."master_categories" (
  "category_id" integer PRIMARY KEY,
  "category_code" varchar UNIQUE NOT NULL,
  "category_name" varchar NOT NULL,
  "parent_category_id" integer,
  "category_level" integer,
  "is_active" boolean DEFAULT true,
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."master_locations" (
  "location_id" integer PRIMARY KEY,
  "location_type" varchar NOT NULL,
  "location_name" varchar NOT NULL,
  "parent_location_id" integer,
  "island_group" varchar,
  "psgc_code" varchar,
  "is_active" boolean DEFAULT true
);

CREATE TABLE "scout"."master_ph_locations" (
  "psgc_code" varchar PRIMARY KEY,
  "region" varchar NOT NULL,
  "province" varchar,
  "city_municipality" varchar,
  "barangay" varchar,
  "geo_level" varchar NOT NULL,
  "population" integer,
  "income_class" varchar
);

CREATE TABLE "scout"."master_stores" (
  "store_code" varchar PRIMARY KEY,
  "store_name" varchar NOT NULL,
  "store_type" varchar,
  "channel" varchar,
  "owner_name" varchar,
  "contact_number" varchar,
  "address" text,
  "location_id" integer,
  "is_active" boolean DEFAULT true
);

CREATE TABLE "scout"."master_items" (
  "item_id" integer PRIMARY KEY,
  "item_code" varchar UNIQUE NOT NULL,
  "item_name" varchar NOT NULL,
  "brand_id" integer,
  "category_id" integer,
  "barcode" varchar,
  "pack_size" varchar,
  "srp" numeric(10,2)
);

CREATE TABLE "scout"."master_product_catalog" (
  "product_id" integer PRIMARY KEY,
  "product_code" varchar UNIQUE NOT NULL,
  "product_name" varchar NOT NULL,
  "brand_id" integer,
  "category_id" integer,
  "variant" varchar,
  "size" varchar,
  "unit" varchar
);

CREATE TABLE "scout"."master_price_list" (
  "price_id" bigserial PRIMARY KEY,
  "product_id" integer NOT NULL,
  "store_type" varchar,
  "price_type" varchar,
  "price" numeric(10,2) NOT NULL,
  "effective_date" date NOT NULL
);

CREATE TABLE "scout"."master_customer_segments" (
  "segment_id" integer PRIMARY KEY,
  "segment_code" varchar UNIQUE NOT NULL,
  "segment_name" varchar NOT NULL,
  "segment_description" text,
  "min_value" numeric(12,2),
  "max_value" numeric(12,2)
);

CREATE TABLE "scout"."master_promotions" (
  "promo_id" integer PRIMARY KEY,
  "promo_code" varchar UNIQUE NOT NULL,
  "promo_name" varchar NOT NULL,
  "promo_type" varchar,
  "start_date" date NOT NULL,
  "end_date" date NOT NULL,
  "discount_rate" numeric(5,2)
);

CREATE TABLE "scout"."master_suppliers" (
  "supplier_id" integer PRIMARY KEY,
  "supplier_code" varchar UNIQUE NOT NULL,
  "supplier_name" varchar NOT NULL,
  "contact_person" varchar,
  "contact_number" varchar,
  "address" text
);

CREATE TABLE "scout"."master_brand_catalog" (
  "catalog_id" integer PRIMARY KEY,
  "brand_id" integer NOT NULL,
  "category_id" integer NOT NULL,
  "product_count" integer,
  "market_share" numeric(5,2)
);

CREATE TABLE "scout"."bridge_product_bundles" (
  "bundle_id" integer PRIMARY KEY,
  "parent_product_key" integer NOT NULL,
  "child_product_key" integer NOT NULL,
  "quantity" integer NOT NULL DEFAULT 1,
  "bundle_price" numeric(10,2)
);

CREATE TABLE "scout"."bridge_product_substitutions" (
  "substitution_id" integer PRIMARY KEY,
  "original_product_key" integer NOT NULL,
  "substitute_product_key" integer NOT NULL,
  "substitution_rank" integer,
  "substitution_rate" numeric(5,2)
);

CREATE TABLE "scout"."bridge_store_campaigns" (
  "store_key" integer NOT NULL,
  "campaign_key" integer NOT NULL,
  "start_date" date NOT NULL,
  "end_date" date,
  "performance_score" numeric(5,2),
  PRIMARY KEY ("store_key", "campaign_key")
);

CREATE TABLE "scout"."bronze_transactions" (
  "raw_id" bigserial PRIMARY KEY,
  "source_system" varchar,
  "raw_data" jsonb NOT NULL,
  "ingestion_timestamp" timestamp DEFAULT 'now()',
  "processing_status" varchar DEFAULT 'pending',
  "error_message" text
);

CREATE TABLE "scout"."bronze_edge_raw" (
  "source_file" text NOT NULL,
  "entry_name" text NOT NULL,
  "txn_id" text,
  "payload" jsonb NOT NULL,
  "ingested_at" timestamptz DEFAULT 'now()',
  PRIMARY KEY ("source_file", "entry_name")
);

CREATE TABLE "scout"."bronze_products" (
  "raw_id" bigserial PRIMARY KEY,
  "source_url" varchar,
  "raw_data" jsonb NOT NULL,
  "scraped_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."bronze_events" (
  "event_id" bigserial PRIMARY KEY,
  "event_type" varchar NOT NULL,
  "payload" jsonb NOT NULL,
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."silver_transactions" (
  "txn_id" text PRIMARY KEY,
  "data" jsonb NOT NULL,
  "loaded_at" timestamptz DEFAULT 'now()',
  "source_file" text NOT NULL
);

CREATE TABLE "scout"."gold_sari_sari_kpis" (
  "id" bigserial PRIMARY KEY,
  "store_code" text NOT NULL,
  "hour_bucket" timestamptz NOT NULL,
  "avg_temperature" numeric(5,2),
  "avg_humidity" numeric(5,2),
  "avg_comfort_index" numeric(5,2),
  "comfort_rating" varchar,
  "total_customers" integer,
  "avg_customers" numeric(8,2),
  "peak_customers" integer,
  "avg_queue_length" numeric(5,2),
  "avg_wait_time_minutes" numeric(5,2),
  "footfall_score" numeric(5,2),
  "engagement_score" numeric(5,2),
  "operational_efficiency" numeric(5,2),
  "avg_cpu_usage" numeric(5,2),
  "avg_memory_usage" numeric(5,2),
  "data_quality_score" numeric(5,2),
  "record_count" integer,
  "created_at" timestamptz DEFAULT 'now()',
  "updated_at" timestamptz DEFAULT 'now()'
);

CREATE TABLE "scout"."scout_gold_transactions" (
  "transaction_id" varchar PRIMARY KEY,
  "store_id" varchar NOT NULL,
  "transaction_date" date NOT NULL,
  "total_amount" numeric(12,2),
  "items_count" integer
);

CREATE TABLE "scout"."scout_gold_transaction_items" (
  "transaction_id" varchar NOT NULL,
  "line_item_id" integer NOT NULL,
  "sku" varchar NOT NULL,
  "brand_name" varchar,
  "quantity" integer,
  "amount" numeric(10,2),
  PRIMARY KEY ("transaction_id", "line_item_id")
);

CREATE TABLE "scout"."etl_queue" (
  "id" bigserial PRIMARY KEY,
  "bucket_id" text NOT NULL,
  "name" text NOT NULL,
  "size_bytes" bigint DEFAULT 0,
  "mime_type" text,
  "sha256_hex" text,
  "status" text NOT NULL DEFAULT 'QUEUED',
  "attempts" integer DEFAULT 0,
  "last_error" text,
  "enqueued_at" timestamptz DEFAULT 'now()',
  "started_at" timestamptz,
  "finished_at" timestamptz
);

CREATE TABLE "scout"."etl_watermarks" (
  "obj_id" text PRIMARY KEY,
  "processed_at" timestamptz NOT NULL DEFAULT 'now()',
  "ok" boolean NOT NULL DEFAULT false,
  "msg" text
);

CREATE TABLE "scout"."etl_failures" (
  "id" bigserial PRIMARY KEY,
  "bucket_id" text NOT NULL,
  "name" text NOT NULL,
  "error_msg" text NOT NULL,
  "attempts" integer DEFAULT 1,
  "failed_at" timestamptz DEFAULT 'now()'
);

CREATE TABLE "scout"."ingestion_log" (
  "ingestion_id" serial PRIMARY KEY,
  "file_name" varchar NOT NULL,
  "file_path" varchar,
  "ingestion_timestamp" timestamp DEFAULT 'now()',
  "records_processed" integer DEFAULT 0,
  "status" varchar DEFAULT 'pending',
  "error_message" text,
  "metadata" jsonb
);

CREATE TABLE "scout"."enrichment_queue" (
  "id" bigserial PRIMARY KEY,
  "entity_type" varchar NOT NULL,
  "entity_id" varchar NOT NULL,
  "enrichment_type" varchar NOT NULL,
  "status" varchar DEFAULT 'pending',
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."report_queue" (
  "id" bigserial PRIMARY KEY,
  "report_type" varchar NOT NULL,
  "parameters" jsonb,
  "status" varchar DEFAULT 'pending',
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."stt_brand_dictionary" (
  "brand_id" integer PRIMARY KEY,
  "brand_name" varchar NOT NULL,
  "variants" jsonb,
  "confidence_threshold" numeric(3,2),
  "is_active" boolean DEFAULT true
);

CREATE TABLE "scout"."scraped_items" (
  "item_id" bigserial PRIMARY KEY,
  "source_url" varchar NOT NULL,
  "sku" varchar,
  "product_name" varchar,
  "brand" varchar,
  "price" numeric(10,2),
  "availability" varchar,
  "scraped_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."scrape_queue" (
  "id" bigserial PRIMARY KEY,
  "url" varchar NOT NULL,
  "priority" integer DEFAULT 5,
  "status" varchar DEFAULT 'pending',
  "created_at" timestamp DEFAULT 'now()'
);

CREATE TABLE "scout"."scrape_sessions" (
  "session_id" bigserial PRIMARY KEY,
  "start_time" timestamp NOT NULL,
  "end_time" timestamp,
  "items_scraped" integer DEFAULT 0,
  "status" varchar
);

CREATE TABLE "scout"."scraper_config" (
  "config_id" integer PRIMARY KEY,
  "site_name" varchar NOT NULL,
  "base_url" varchar NOT NULL,
  "selectors" jsonb NOT NULL,
  "is_active" boolean DEFAULT true
);

CREATE UNIQUE INDEX ON "scout"."dim_date" ("full_date");

CREATE UNIQUE INDEX ON "scout"."dim_time" ("full_time");

CREATE UNIQUE INDEX ON "scout"."dim_stores" ("store_id");

CREATE UNIQUE INDEX ON "scout"."dim_customers" ("customer_id");

CREATE UNIQUE INDEX ON "scout"."dim_products" ("sku");

CREATE UNIQUE INDEX ON "scout"."dim_campaigns" ("campaign_id");

CREATE UNIQUE INDEX ON "scout"."dim_payment_methods" ("payment_method");

CREATE UNIQUE INDEX ON "scout"."dim_geometries" ("geom_code");

CREATE INDEX ON "scout"."dim_geometries" ("geom_type");

CREATE INDEX ON "scout"."fact_transactions" ("store_id", "transaction_date");

CREATE INDEX ON "scout"."fact_transactions" ("customer_id", "transaction_date");

CREATE INDEX ON "scout"."fact_transactions" ("transaction_date");

CREATE INDEX ON "scout"."fact_transaction_items" ("sku");

CREATE INDEX ON "scout"."fact_transaction_items" ("brand_id");

CREATE INDEX ON "scout"."fact_consumer_behavior" ("transaction_id");

CREATE INDEX ON "scout"."fact_consumer_behavior" ("customer_id");

CREATE INDEX ON "scout"."fact_basket_analysis" ("as_of_date");

CREATE INDEX ON "scout"."fact_basket_analysis" ("product_key", "co_product_key");

CREATE INDEX ON "scout"."fact_substitutions" ("as_of_date");

CREATE INDEX ON "scout"."fact_substitutions" ("product_key", "substitute_key");

CREATE INDEX ON "scout"."fact_request_patterns" ("store_key", "as_of_date", "hour_bucket");

CREATE INDEX ON "scout"."fact_transaction_duration" ("store_key", "as_of_date");

CREATE INDEX ON "scout"."fact_monthly_performance" ("date_key", "store_key", "product_key");

CREATE INDEX ON "scout"."bronze_transactions" ("processing_status");

CREATE INDEX ON "scout"."bronze_transactions" ("ingestion_timestamp");

CREATE INDEX ON "scout"."bronze_edge_raw" ("txn_id");

CREATE INDEX ON "scout"."silver_transactions" ("source_file");

CREATE INDEX ON "scout"."silver_transactions" ("loaded_at");

CREATE INDEX ON "scout"."gold_sari_sari_kpis" ("store_code", "hour_bucket");

CREATE INDEX ON "scout"."etl_queue" ("status");

CREATE INDEX ON "scout"."etl_queue" ("enqueued_at");

CREATE INDEX ON "scout"."etl_failures" ("failed_at");

COMMENT ON COLUMN "scout"."dim_date"."date_key" IS 'Surrogate key YYYYMMDD format';

COMMENT ON COLUMN "scout"."dim_time"."time_key" IS 'Surrogate key HHMMSS format';

COMMENT ON COLUMN "scout"."dim_time"."time_of_day" IS 'Morning, Afternoon, Evening, Night';

COMMENT ON TABLE "scout"."dim_stores" IS 'SCD Type 2 for store dimension changes';

COMMENT ON TABLE "scout"."dim_customers" IS 'SCD Type 2 for customer dimension changes';

COMMENT ON TABLE "scout"."dim_products" IS 'SCD Type 2 for product dimension changes';

COMMENT ON TABLE "scout"."dim_geometries" IS 'Geographic boundaries for Philippines administrative divisions';

COMMENT ON COLUMN "scout"."dim_geometries"."geom_type" IS 'region|province|city|barangay|custom';

COMMENT ON TABLE "scout"."fact_transactions" IS 'Core transaction fact table with RLS enabled';

COMMENT ON COLUMN "scout"."fact_transactions"."status" IS 'pending, completed, cancelled, failed';

COMMENT ON TABLE "scout"."fact_transaction_items" IS 'Transaction line items with brand/category detection';

COMMENT ON TABLE "scout"."fact_daily_sales" IS 'Pre-aggregated daily sales for performance';

COMMENT ON TABLE "scout"."fact_basket_analysis" IS 'Association rules for product affinity analysis';

COMMENT ON TABLE "scout"."fact_substitutions" IS 'Product substitution patterns when items are out of stock';

COMMENT ON TABLE "scout"."fact_request_patterns" IS 'Consumer request patterns by hour of day';

COMMENT ON COLUMN "scout"."fact_request_patterns"."request_type" IS 'branded|unbranded|unsure';

COMMENT ON COLUMN "scout"."fact_request_patterns"."hour_bucket" IS '0-23 hour of day';

COMMENT ON TABLE "scout"."fact_transaction_duration" IS 'Transaction timing for checkout efficiency analysis';

COMMENT ON TABLE "scout"."fact_monthly_performance" IS 'Pre-aggregated monthly metrics for executive dashboards';

COMMENT ON TABLE "scout"."master_brands" IS 'Brand registry with parent company relationships';

COMMENT ON TABLE "scout"."master_categories" IS 'Product category taxonomy';

COMMENT ON TABLE "scout"."master_locations" IS 'Geographic hierarchy for Philippines';

COMMENT ON TABLE "scout"."master_ph_locations" IS 'Philippines Standard Geographic Code reference';

COMMENT ON TABLE "scout"."master_stores" IS 'Store master data including sari-sari stores';

COMMENT ON TABLE "scout"."master_items" IS 'Item master catalog';

COMMENT ON TABLE "scout"."master_product_catalog" IS 'Complete product catalog';

COMMENT ON TABLE "scout"."master_price_list" IS 'Price list by product and store type';

COMMENT ON TABLE "scout"."master_customer_segments" IS 'Customer segmentation definitions';

COMMENT ON TABLE "scout"."master_promotions" IS 'Promotional campaigns';

COMMENT ON TABLE "scout"."master_suppliers" IS 'Supplier master data';

COMMENT ON TABLE "scout"."master_brand_catalog" IS 'Brand-category relationships';

COMMENT ON TABLE "scout"."bridge_product_bundles" IS 'Product bundle definitions';

COMMENT ON TABLE "scout"."bridge_product_substitutions" IS 'Product substitution mapping';

COMMENT ON TABLE "scout"."bridge_store_campaigns" IS 'Store-campaign assignments';

COMMENT ON TABLE "scout"."bronze_transactions" IS 'Raw transaction data landing zone';

COMMENT ON TABLE "scout"."bronze_edge_raw" IS 'Edge device raw data with RLS';

COMMENT ON TABLE "scout"."bronze_products" IS 'Raw product data from web scraping';

COMMENT ON TABLE "scout"."bronze_events" IS 'Raw event stream data';

COMMENT ON TABLE "scout"."silver_transactions" IS 'Cleansed and validated transactions';

COMMENT ON TABLE "scout"."gold_sari_sari_kpis" IS 'Sari-sari store operational KPIs';

COMMENT ON TABLE "scout"."scout_gold_transactions" IS 'Gold layer optimized transactions';

COMMENT ON TABLE "scout"."scout_gold_transaction_items" IS 'Gold layer optimized transaction items';

COMMENT ON TABLE "scout"."etl_queue" IS 'ETL job queue management';

COMMENT ON TABLE "scout"."etl_watermarks" IS 'ETL processing checkpoints';

COMMENT ON TABLE "scout"."etl_failures" IS 'ETL failure tracking';

COMMENT ON TABLE "scout"."ingestion_log" IS 'Data ingestion audit log';

COMMENT ON TABLE "scout"."enrichment_queue" IS 'Data enrichment processing queue';

COMMENT ON TABLE "scout"."report_queue" IS 'Report generation queue';

COMMENT ON TABLE "scout"."stt_brand_dictionary" IS 'Speech-to-text brand detection dictionary';

COMMENT ON TABLE "scout"."scraped_items" IS 'Web-scraped product data';

COMMENT ON TABLE "scout"."scrape_queue" IS 'Web scraping job queue';

COMMENT ON TABLE "scout"."scrape_sessions" IS 'Scraping session tracking';

COMMENT ON TABLE "scout"."scraper_config" IS 'Scraper configuration by site';

ALTER TABLE "scout"."fact_transactions" ADD FOREIGN KEY ("date_key") REFERENCES "scout"."dim_date" ("date_key");

ALTER TABLE "scout"."fact_transactions" ADD FOREIGN KEY ("time_key") REFERENCES "scout"."dim_time" ("time_key");

ALTER TABLE "scout"."fact_transactions" ADD FOREIGN KEY ("store_key") REFERENCES "scout"."dim_stores" ("store_key");

ALTER TABLE "scout"."fact_transactions" ADD FOREIGN KEY ("customer_key") REFERENCES "scout"."dim_customers" ("customer_key");

ALTER TABLE "scout"."fact_transactions" ADD FOREIGN KEY ("campaign_key") REFERENCES "scout"."dim_campaigns" ("campaign_key");

ALTER TABLE "scout"."fact_transactions" ADD FOREIGN KEY ("payment_key") REFERENCES "scout"."dim_payment_methods" ("payment_key");

ALTER TABLE "scout"."fact_transaction_items" ADD FOREIGN KEY ("transaction_id") REFERENCES "scout"."fact_transactions" ("transaction_id");

ALTER TABLE "scout"."fact_transaction_items" ADD FOREIGN KEY ("product_key") REFERENCES "scout"."dim_products" ("product_key");

ALTER TABLE "scout"."fact_daily_sales" ADD FOREIGN KEY ("date_key") REFERENCES "scout"."dim_date" ("date_key");

ALTER TABLE "scout"."fact_daily_sales" ADD FOREIGN KEY ("store_key") REFERENCES "scout"."dim_stores" ("store_key");

ALTER TABLE "scout"."fact_daily_sales" ADD FOREIGN KEY ("product_key") REFERENCES "scout"."dim_products" ("product_key");

ALTER TABLE "scout"."fact_consumer_behavior" ADD FOREIGN KEY ("transaction_id") REFERENCES "scout"."fact_transactions" ("transaction_id");

ALTER TABLE "scout"."master_categories" ADD FOREIGN KEY ("parent_category_id") REFERENCES "scout"."master_categories" ("category_id");

ALTER TABLE "scout"."master_locations" ADD FOREIGN KEY ("parent_location_id") REFERENCES "scout"."master_locations" ("location_id");

ALTER TABLE "scout"."master_items" ADD FOREIGN KEY ("brand_id") REFERENCES "scout"."master_brands" ("brand_id");

ALTER TABLE "scout"."master_items" ADD FOREIGN KEY ("category_id") REFERENCES "scout"."master_categories" ("category_id");

ALTER TABLE "scout"."master_product_catalog" ADD FOREIGN KEY ("brand_id") REFERENCES "scout"."master_brands" ("brand_id");

ALTER TABLE "scout"."master_product_catalog" ADD FOREIGN KEY ("category_id") REFERENCES "scout"."master_categories" ("category_id");

ALTER TABLE "scout"."master_price_list" ADD FOREIGN KEY ("product_id") REFERENCES "scout"."master_product_catalog" ("product_id");

ALTER TABLE "scout"."master_brand_catalog" ADD FOREIGN KEY ("brand_id") REFERENCES "scout"."master_brands" ("brand_id");

ALTER TABLE "scout"."master_brand_catalog" ADD FOREIGN KEY ("category_id") REFERENCES "scout"."master_categories" ("category_id");

ALTER TABLE "scout"."master_stores" ADD FOREIGN KEY ("location_id") REFERENCES "scout"."master_locations" ("location_id");

ALTER TABLE "scout"."bridge_product_bundles" ADD FOREIGN KEY ("parent_product_key") REFERENCES "scout"."dim_products" ("product_key");

ALTER TABLE "scout"."bridge_product_bundles" ADD FOREIGN KEY ("child_product_key") REFERENCES "scout"."dim_products" ("product_key");

ALTER TABLE "scout"."bridge_product_substitutions" ADD FOREIGN KEY ("original_product_key") REFERENCES "scout"."dim_products" ("product_key");

ALTER TABLE "scout"."bridge_product_substitutions" ADD FOREIGN KEY ("substitute_product_key") REFERENCES "scout"."dim_products" ("product_key");

ALTER TABLE "scout"."bridge_store_campaigns" ADD FOREIGN KEY ("store_key") REFERENCES "scout"."dim_stores" ("store_key");

ALTER TABLE "scout"."bridge_store_campaigns" ADD FOREIGN KEY ("campaign_key") REFERENCES "scout"."dim_campaigns" ("campaign_key");

ALTER TABLE "scout"."scout_gold_transaction_items" ADD FOREIGN KEY ("transaction_id") REFERENCES "scout"."scout_gold_transactions" ("transaction_id");
