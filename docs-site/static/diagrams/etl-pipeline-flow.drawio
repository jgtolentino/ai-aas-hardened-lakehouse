<mxfile host="app.diagrams.net" modified="2025-01-17T00:00:00.000Z" agent="5.0" version="24.2.5" etag="etl-pipeline-flow" type="device">
  <diagram name="ETL Pipeline Architecture - Medallion" id="etl-pipeline-medallion">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- Title -->
        <mxCell id="title" value="AI-AAS Hardened Lakehouse - ETL Pipeline with Medallion Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="184" y="20" width="801" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Data Sources Layer -->
        <mxCell id="data_sources_layer" value="Data Sources" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Edge Devices -->
        <mxCell id="edge_devices" value="ðŸ“± Edge Devices&#xa;Scout Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Storage Bucket -->
        <mxCell id="storage_bucket" value="ðŸ—‚ï¸ Storage Bucket&#xa;ZIP Files" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="240" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- APIs -->
        <mxCell id="apis" value="ðŸ”Œ External APIs&#xa;Real-time Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="400" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- S3/Cloud Storage -->
        <mxCell id="s3_storage" value="â˜ï¸ S3/Cloud&#xa;Batch Files" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="560" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Xata -->
        <mxCell id="xata" value="ðŸ—„ï¸ Xata&#xa;NoSQL Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="720" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Ingestion & Queue Layer -->
        <mxCell id="ingestion_layer" value="Ingestion &amp; Processing Queue" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="1080" height="80" as="geometry"/>
        </mxCell>
        
        <!-- ETL Queue -->
        <mxCell id="etl_queue" value="ðŸ“Š ETL Queue&#xa;scout.etl_queue" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffcc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="240" y="220" width="140" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Edge Function -->
        <mxCell id="edge_function" value="âš¡ Edge Function&#xa;process-etl-pipeline" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffcc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="420" y="220" width="140" height="40" as="geometry"/>
        </mxCell>
        
        <!-- ETL Metadata -->
        <mxCell id="etl_metadata" value="ðŸ“‹ ETL Metadata&#xa;Tracking &amp; Lineage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffcc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="600" y="220" width="140" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Bronze Layer -->
        <mxCell id="bronze_layer" value="ðŸ¥‰ BRONZE Layer - Raw Data Landing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cd7f32;strokeColor=#8B4513;fontSize=14;fontStyle=1;verticalAlign=top;fontColor=white;" vertex="1" parent="1">
          <mxGeometry x="40" y="300" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Bronze Tables -->
        <mxCell id="bronze_edge_raw" value="ðŸ“¥ bronze_edge_raw&#xa;â€¢ payload: JSONB&#xa;â€¢ source_file: TEXT&#xa;â€¢ ingested_at: TIMESTAMP" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="bronze_transactions_raw" value="ðŸ“¥ bronze_transactions_raw&#xa;â€¢ payload: JSONB&#xa;â€¢ source_id: TEXT&#xa;â€¢ processed: BOOLEAN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="bronze_characteristics" value="âœ… Bronze Characteristics&#xa;â€¢ No transformations&#xa;â€¢ Immutable records&#xa;â€¢ Source lineage tracking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Bronze Model -->
        <mxCell id="dbt_bronze" value="ðŸ”§ DBT: bronze_sales.sql&#xa;SELECT from Supabase&#xa;â†’ Iceberg bronze.sales" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Silver Layer -->
        <mxCell id="silver_layer" value="ðŸ¥ˆ SILVER Layer - Cleaned &amp; Validated Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C0C0C0;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="420" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Silver Tables -->
        <mxCell id="silver_transactions" value="ðŸ“Š silver_transactions&#xa;â€¢ txn_id: TEXT (PK)&#xa;â€¢ data: JSONB (validated)&#xa;â€¢ source_file: TEXT" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="silver_transform" value="ðŸ”„ Transform Function&#xa;transform_edge_bronze_to_silver()&#xa;â€¢ Type casting&#xa;â€¢ Data validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="silver_characteristics" value="âœ… Silver Characteristics&#xa;â€¢ Typed columns&#xa;â€¢ Deduplicated (txn_id)&#xa;â€¢ Business constraints" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Silver Model -->
        <mxCell id="dbt_silver" value="ðŸ”§ DBT: silver_sales.sql&#xa;â€¢ CAST types&#xa;â€¢ TRIM strings&#xa;â€¢ WHERE validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Gold Layer -->
        <mxCell id="gold_layer" value="ðŸ¥‡ GOLD Layer - Business-Ready Analytics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFD700;strokeColor=#B8860B;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="540" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Gold Tables -->
        <mxCell id="fact_transactions" value="â­ fact_transactions&#xa;â€¢ Business metrics&#xa;â€¢ Aggregated data&#xa;â€¢ Star schema" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="fact_items" value="â­ fact_transaction_items&#xa;â€¢ Line item details&#xa;â€¢ Product analytics&#xa;â€¢ Basket analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="260" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="gold_views" value="ðŸ“Š Gold Views&#xa;â€¢ v_gold_region_choropleth&#xa;â€¢ v_gold_sales_daily&#xa;â€¢ v_gold_flat" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="440" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="gold_aggregates" value="ðŸ“ˆ Aggregations&#xa;â€¢ Regional summaries&#xa;â€¢ Time series&#xa;â€¢ KPI metrics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="620" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Gold Model -->
        <mxCell id="dbt_gold" value="ðŸ”§ DBT: gold_sales_daily.sql&#xa;â€¢ DATE_TRUNC&#xa;â€¢ GROUP BY region&#xa;â€¢ SUM aggregations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="560" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Platinum Layer -->
        <mxCell id="platinum_layer" value="ðŸ’Ž PLATINUM Layer - ML Features &amp; AI Training Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E5E4E2;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="660" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Platinum Components -->
        <mxCell id="feature_store" value="ðŸ¤– Feature Store&#xa;â€¢ ML-ready features&#xa;â€¢ Time-series windows&#xa;â€¢ Entity-based" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="ai_training" value="ðŸ§  AI Training Sets&#xa;â€¢ Model inputs&#xa;â€¢ Training/validation splits&#xa;â€¢ Feature vectors" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="specialized_exports" value="ðŸ“¤ Specialized Exports&#xa;â€¢ BI tool formats&#xa;â€¢ API responses&#xa;â€¢ Real-time serving" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Platinum Model -->
        <mxCell id="dbt_platinum" value="ðŸ”§ DBT: feature_store_sales_7d&#xa;â€¢ JSON_BUILD_OBJECT&#xa;â€¢ Rolling windows&#xa;â€¢ Feature engineering" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Flow Arrows -->
        <!-- Sources to Queue -->
        <mxCell id="flow_to_queue" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#9673a6;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="180" as="sourcePoint"/>
            <mxPoint x="460" y="200" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Queue to Bronze -->
        <mxCell id="flow_to_bronze" value="Ingestion" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#d6b656;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="280" as="sourcePoint"/>
            <mxPoint x="460" y="300" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Bronze to Silver -->
        <mxCell id="flow_to_silver" value="transform_edge_bronze_to_silver()" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#8B4513;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="400" as="sourcePoint"/>
            <mxPoint x="460" y="420" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Silver to Gold -->
        <mxCell id="flow_to_gold" value="transform_silver_to_gold()" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#666666;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="520" as="sourcePoint"/>
            <mxPoint x="460" y="540" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Gold to Platinum -->
        <mxCell id="flow_to_platinum" value="Feature Engineering" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#B8860B;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="640" as="sourcePoint"/>
            <mxPoint x="460" y="660" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Monitoring Sidebar -->
        <mxCell id="monitoring_sidebar" value="Monitoring &amp; Lineage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#8e24aa;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1040" y="300" width="120" height="460" as="geometry"/>
        </mxCell>
        
        <!-- Monitoring Components -->
        <mxCell id="medallion_metadata" value="ðŸ“Š Medallion&#xa;Metadata" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="330" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="pipeline_status" value="ðŸ“ˆ Pipeline&#xa;Status View" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="380" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="data_quality" value="ðŸ” Data Quality&#xa;Issues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="430" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="source_lineage" value="ðŸ”— Source File&#xa;Lineage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="480" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="health_check" value="â¤ï¸ Pipeline&#xa;Health Check" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="530" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="panic_view" value="ðŸš¨ Panic View&#xa;Stuck Records" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="580" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <!-- DBT Sidebar -->
        <mxCell id="dbt_sidebar" value="DBT Orchestration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1040" y="80" width="120" height="200" as="geometry"/>
        </mxCell>
        
        <!-- DBT Components -->
        <mxCell id="dbt_project" value="ðŸ“ dbt_project.yml&#xa;Profile: scout" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5f5d5;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="110" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="dbt_models" value="ðŸ“‚ Models&#xa;/bronze&#xa;/silver&#xa;/gold&#xa;/platinum" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5f5d5;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1050" y="160" width="100" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="dbt_cronjob" value="â° Cron Job&#xa;Scheduled runs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5f5d5;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="230" width="100" height="40" as="geometry"/>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>