<mxfile host="app.diagrams.net" modified="2025-01-17T00:00:00.000Z" agent="5.0" version="24.2.5" etag="etl-pipeline-flow" type="device">
  <diagram name="ETL Pipeline Architecture - Medallion" id="etl-pipeline-medallion">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- Title -->
        <mxCell id="title" value="AI-AAS Hardened Lakehouse - ETL Pipeline with Medallion Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="184" y="20" width="801" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Data Sources Layer -->
        <mxCell id="data_sources_layer" value="Data Sources" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Edge Devices -->
        <mxCell id="edge_devices" value="📱 Edge Devices&#xa;Scout Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Storage Bucket -->
        <mxCell id="storage_bucket" value="🗂️ Storage Bucket&#xa;ZIP Files" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="240" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- APIs -->
        <mxCell id="apis" value="🔌 External APIs&#xa;Real-time Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="400" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- S3/Cloud Storage -->
        <mxCell id="s3_storage" value="☁️ S3/Cloud&#xa;Batch Files" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="560" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Xata -->
        <mxCell id="xata" value="🗄️ Xata&#xa;NoSQL Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="720" y="110" width="120" height="50" as="geometry"/>
        </mxCell>
        
        <!-- Ingestion & Queue Layer -->
        <mxCell id="ingestion_layer" value="Ingestion &amp; Processing Queue" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="1080" height="80" as="geometry"/>
        </mxCell>
        
        <!-- ETL Queue -->
        <mxCell id="etl_queue" value="📊 ETL Queue&#xa;scout.etl_queue" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffcc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="240" y="220" width="140" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Edge Function -->
        <mxCell id="edge_function" value="⚡ Edge Function&#xa;process-etl-pipeline" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffcc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="420" y="220" width="140" height="40" as="geometry"/>
        </mxCell>
        
        <!-- ETL Metadata -->
        <mxCell id="etl_metadata" value="📋 ETL Metadata&#xa;Tracking &amp; Lineage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffcc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="600" y="220" width="140" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Bronze Layer -->
        <mxCell id="bronze_layer" value="🥉 BRONZE Layer - Raw Data Landing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cd7f32;strokeColor=#8B4513;fontSize=14;fontStyle=1;verticalAlign=top;fontColor=white;" vertex="1" parent="1">
          <mxGeometry x="40" y="300" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Bronze Tables -->
        <mxCell id="bronze_edge_raw" value="📥 bronze_edge_raw&#xa;• payload: JSONB&#xa;• source_file: TEXT&#xa;• ingested_at: TIMESTAMP" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="bronze_transactions_raw" value="📥 bronze_transactions_raw&#xa;• payload: JSONB&#xa;• source_id: TEXT&#xa;• processed: BOOLEAN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="bronze_characteristics" value="✅ Bronze Characteristics&#xa;• No transformations&#xa;• Immutable records&#xa;• Source lineage tracking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Bronze Model -->
        <mxCell id="dbt_bronze" value="🔧 DBT: bronze_sales.sql&#xa;SELECT from Supabase&#xa;→ Iceberg bronze.sales" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4a574;strokeColor=#8B4513;fontColor=white;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="320" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Silver Layer -->
        <mxCell id="silver_layer" value="🥈 SILVER Layer - Cleaned &amp; Validated Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C0C0C0;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="420" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Silver Tables -->
        <mxCell id="silver_transactions" value="📊 silver_transactions&#xa;• txn_id: TEXT (PK)&#xa;• data: JSONB (validated)&#xa;• source_file: TEXT" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="silver_transform" value="🔄 Transform Function&#xa;transform_edge_bronze_to_silver()&#xa;• Type casting&#xa;• Data validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="silver_characteristics" value="✅ Silver Characteristics&#xa;• Typed columns&#xa;• Deduplicated (txn_id)&#xa;• Business constraints" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Silver Model -->
        <mxCell id="dbt_silver" value="🔧 DBT: silver_sales.sql&#xa;• CAST types&#xa;• TRIM strings&#xa;• WHERE validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="440" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Gold Layer -->
        <mxCell id="gold_layer" value="🥇 GOLD Layer - Business-Ready Analytics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFD700;strokeColor=#B8860B;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="540" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Gold Tables -->
        <mxCell id="fact_transactions" value="⭐ fact_transactions&#xa;• Business metrics&#xa;• Aggregated data&#xa;• Star schema" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="fact_items" value="⭐ fact_transaction_items&#xa;• Line item details&#xa;• Product analytics&#xa;• Basket analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="260" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="gold_views" value="📊 Gold Views&#xa;• v_gold_region_choropleth&#xa;• v_gold_sales_daily&#xa;• v_gold_flat" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="440" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="gold_aggregates" value="📈 Aggregations&#xa;• Regional summaries&#xa;• Time series&#xa;• KPI metrics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="620" y="560" width="160" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Gold Model -->
        <mxCell id="dbt_gold" value="🔧 DBT: gold_sales_daily.sql&#xa;• DATE_TRUNC&#xa;• GROUP BY region&#xa;• SUM aggregations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffed4e;strokeColor=#B8860B;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="560" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Platinum Layer -->
        <mxCell id="platinum_layer" value="💎 PLATINUM Layer - ML Features &amp; AI Training Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E5E4E2;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="660" width="1080" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Platinum Components -->
        <mxCell id="feature_store" value="🤖 Feature Store&#xa;• ML-ready features&#xa;• Time-series windows&#xa;• Entity-based" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="ai_training" value="🧠 AI Training Sets&#xa;• Model inputs&#xa;• Training/validation splits&#xa;• Feature vectors" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="320" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="specialized_exports" value="📤 Specialized Exports&#xa;• BI tool formats&#xa;• API responses&#xa;• Real-time serving" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="560" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DBT Platinum Model -->
        <mxCell id="dbt_platinum" value="🔧 DBT: feature_store_sales_7d&#xa;• JSON_BUILD_OBJECT&#xa;• Rolling windows&#xa;• Feature engineering" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;align=left;" vertex="1" parent="1">
          <mxGeometry x="800" y="680" width="200" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Flow Arrows -->
        <!-- Sources to Queue -->
        <mxCell id="flow_to_queue" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#9673a6;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="180" as="sourcePoint"/>
            <mxPoint x="460" y="200" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Queue to Bronze -->
        <mxCell id="flow_to_bronze" value="Ingestion" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#d6b656;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="280" as="sourcePoint"/>
            <mxPoint x="460" y="300" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Bronze to Silver -->
        <mxCell id="flow_to_silver" value="transform_edge_bronze_to_silver()" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#8B4513;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="400" as="sourcePoint"/>
            <mxPoint x="460" y="420" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Silver to Gold -->
        <mxCell id="flow_to_gold" value="transform_silver_to_gold()" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#666666;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="520" as="sourcePoint"/>
            <mxPoint x="460" y="540" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Gold to Platinum -->
        <mxCell id="flow_to_platinum" value="Feature Engineering" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#B8860B;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="640" as="sourcePoint"/>
            <mxPoint x="460" y="660" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <!-- Monitoring Sidebar -->
        <mxCell id="monitoring_sidebar" value="Monitoring &amp; Lineage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#8e24aa;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1040" y="300" width="120" height="460" as="geometry"/>
        </mxCell>
        
        <!-- Monitoring Components -->
        <mxCell id="medallion_metadata" value="📊 Medallion&#xa;Metadata" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="330" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="pipeline_status" value="📈 Pipeline&#xa;Status View" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="380" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="data_quality" value="🔍 Data Quality&#xa;Issues" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="430" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="source_lineage" value="🔗 Source File&#xa;Lineage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="480" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="health_check" value="❤️ Pipeline&#xa;Health Check" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="530" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="panic_view" value="🚨 Panic View&#xa;Stuck Records" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#8e24aa;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="580" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <!-- DBT Sidebar -->
        <mxCell id="dbt_sidebar" value="DBT Orchestration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1040" y="80" width="120" height="200" as="geometry"/>
        </mxCell>
        
        <!-- DBT Components -->
        <mxCell id="dbt_project" value="📁 dbt_project.yml&#xa;Profile: scout" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5f5d5;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="110" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="dbt_models" value="📂 Models&#xa;/bronze&#xa;/silver&#xa;/gold&#xa;/platinum" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5f5d5;strokeColor=#82b366;fontSize=11;align=left;" vertex="1" parent="1">
          <mxGeometry x="1050" y="160" width="100" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="dbt_cronjob" value="⏰ Cron Job&#xa;Scheduled runs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5f5d5;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1050" y="230" width="100" height="40" as="geometry"/>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>