# Superset Environment Variables - Production

# Core Settings
SUPERSET_ENV=production
SECRET_KEY=${SUPERSET_SECRET_KEY}  # From secrets vault
SUPERSET_LOAD_EXAMPLES=false

# Database Connection (production)
SQLALCHEMY_DATABASE_URI=postgresql://${DB_USER}:${DB_PASS}@${DB_HOST}:5432/superset?sslmode=require

# Feature Flags (production-safe)
FEATURE_FLAGS={
  "ENABLE_TEMPLATE_PROCESSING": true,
  "ENABLE_PROXY_FIX": true,
  "ENABLE_CORS": false,
  "ENABLE_JAVASCRIPT_CONTROLS": false,
  "DASHBOARD_NATIVE_FILTERS": true,
  "DASHBOARD_CROSS_FILTERS": true,
  "GENERIC_CHART_AXES": true,
  "ALERT_REPORTS": true,
  "SCHEDULED_REPORTS": true,
  "DASHBOARD_RBAC": true,
  "ENABLE_EXPLORE_DRAG_AND_DROP": true,
  "DISABLE_DATASET_SOURCE_EDIT": true
}

# Security Settings (strict)
WTF_CSRF_ENABLED=true
WTF_CSRF_TIME_LIMIT=86400  # 1 day
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Strict
SESSION_PERMANENT=false
PERMANENT_SESSION_LIFETIME=1800  # 30 minutes

# Authentication
AUTH_TYPE=OAUTH
AUTH_USER_REGISTRATION=false
AUTH_USER_REGISTRATION_ROLE=Gamma

# Cache Configuration (Redis Sentinel)
CACHE_TYPE=redis
CACHE_REDIS_SENTINEL_MASTER=scout-cache
CACHE_REDIS_SENTINELS=[["redis-sentinel-1", 26379], ["redis-sentinel-2", 26379], ["redis-sentinel-3", 26379]]
CACHE_DEFAULT_TIMEOUT=3600
CACHE_KEY_PREFIX=superset_prod_

# Logging (structured)
LOG_LEVEL=WARNING
LOG_FORMAT=json
ENABLE_CORS_LOGGING=false
ENABLE_TIME_ROTATE=true

# Celery Configuration (Redis Sentinel)
CELERY_BROKER_URL=sentinel://redis-sentinel-1:26379,redis-sentinel-2:26379,redis-sentinel-3:26379/2
CELERY_RESULT_BACKEND=sentinel://redis-sentinel-1:26379,redis-sentinel-2:26379,redis-sentinel-3:26379/3
CELERY_TASK_PROTOCOL=2
CELERY_RESULT_EXPIRES=86400

# Performance Settings
SQLLAB_TIMEOUT=300
SUPERSET_WEBSERVER_TIMEOUT=300
SQL_MAX_ROW=10000
SAMPLES_ROW_LIMIT=1000
FILTER_SELECT_ROW_LIMIT=10000

# Email Configuration
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_STARTTLS=true
SMTP_SSL=false
SMTP_USER=${SMTP_USER}
SMTP_PASSWORD=${SMTP_PASSWORD}
SMTP_MAIL_FROM=superset@example.com
EMAIL_REPORTS_SUBJECT_PREFIX=[Scout Analytics]

# Monitoring
SENTRY_DSN=${SENTRY_DSN_PROD}
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# Content Security Policy
TALISMAN_ENABLED=true
TALISMAN_CONFIG={
  "content_security_policy": {
    "default-src": ["'self'"],
    "img-src": ["'self'", "data:", "https://api.mapbox.com"],
    "script-src": ["'self'", "'unsafe-inline'"],
    "style-src": ["'self'", "'unsafe-inline'"],
    "font-src": ["'self'"]
  },
  "force_https": true,
  "force_https_permanent": true
}

# Rate Limiting
RATELIMIT_ENABLED=true
RATELIMIT_APPLICATION="60 per minute"

# Data Export Limits
CSV_EXPORT_MAX_ROWS=50000
EXCEL_EXPORT_MAX_ROWS=50000