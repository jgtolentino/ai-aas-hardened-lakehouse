id: semantic-layer
title: "Scout Semantic Layer Agent"
department: analytics
agent_type: traditional
description: |
  Advanced business intelligence agent that provides natural language querying 
  capabilities over structured data using semantic objects (metrics, dimensions, entities).
  
  Enables business users to query Scout data using business terms without SQL knowledge,
  with built-in role-based access control and quality assertions.

keywords:
  - semantic-layer
  - business-intelligence
  - natural-language
  - sql-generation
  - analytics
  - metrics
  - dimensions

capabilities:
  - semantic_query_execution
  - natural_language_processing
  - sql_generation
  - role_based_access
  - catalog_management
  - model_testing
  - quality_control

tools:
  - supabase_rpc
  - edge_functions
  - database_operations

permissions:
  allow_shell: false
  allow_credentials: false
  allow_network: true

mcp_tools:
  - mcp__supabase__execute_sql
  - mcp__supabase__list_tables
  - mcp__supabase__apply_migration

configuration:
  semantic_layer:
    schema: scout
    api_schema: api
    default_source: scout.gold_daily_metrics
    
  edge_functions:
    semantic_proxy: functions/v1/semantic-proxy
    semantic_calc: functions/v1/semantic-calc  
    semantic_suggest: functions/v1/semantic-suggest
    
  roles:
    admin: full_access
    author: create_edit_objects
    reader: read_verified_only
    
  objects:
    metrics:
      - name: Revenue
        expression: SUM(total_revenue)
        source: scout.gold_daily_metrics
      - name: Transactions
        expression: COUNT(transaction_id)
        source: scout.gold_daily_metrics
      - name: Units
        expression: SUM(total_units)
        source: scout.gold_daily_metrics
        
    dimensions:
      - name: Date
        column: transaction_date
        source: scout.gold_daily_metrics
      - name: Region
        column: region_name
        source: scout.gold_daily_metrics
      - name: Brand
        column: brand_name  
        source: scout.gold_daily_metrics

prompt_excerpts:
  system: |
    You are the Scout Semantic Layer Agent, specializing in business intelligence 
    and natural language data querying. You help users explore Scout retail data 
    using business terms instead of SQL.

    Your core capabilities:
    1. **Semantic Queries**: Execute queries using business terms (Revenue, Region, Date)
    2. **Natural Language Processing**: Convert expressions like "basket size = units / transactions"
    3. **Catalog Management**: Browse and suggest available metrics and dimensions
    4. **Role-Based Security**: Ensure proper access control based on user roles
    5. **Model Testing**: Validate semantic objects and assertions

    Always prioritize data accuracy, security, and user-friendly explanations.
    
  user_interaction: |
    I can help you query Scout data using natural language. Here are some examples:
    
    ðŸ“Š **Query Builder**: "Show me Revenue and Transactions by Date and Region"
    ðŸ§® **Expression Calculator**: "Calculate basket size = units / transactions" 
    ðŸ“š **Catalog Browser**: "What metrics are available for scout data?"
    ðŸ”’ **Access Control**: "What can I access with my current role?"
    
    Just describe what data you need in business terms!

workflows:
  semantic_query:
    description: Execute business intelligence queries using semantic objects
    steps:
      - validate_objects: Check if requested objects exist and are accessible
      - build_query: Convert semantic request to optimized SQL
      - execute_query: Run query with proper security context
      - format_results: Return structured data with metadata
    
  expression_builder:
    description: Convert natural language to calculated expressions
    steps:
      - parse_nl: Extract tokens and operators from natural language
      - map_tokens: Map business terms to database columns
      - validate_expression: Check SQL syntax and semantics  
      - suggest_improvements: Recommend optimizations or alternatives
    
  catalog_management:
    description: Browse and manage semantic catalog
    steps:
      - list_sources: Show available data sources
      - show_objects: Display metrics and dimensions by source
      - suggest_joins: Recommend join paths between sources
      - validate_access: Check user permissions for objects

integration:
  edge_functions:
    base_url: "${SUPABASE_URL}/functions/v1"
    auth_header: "Authorization: Bearer ${SUPABASE_ANON_KEY}"
    
  database:
    schema: scout
    rpc_functions:
      - semantic_query
      - semantic_calculate  
      - semantic_suggest
      - semantic_test
      
  ui_components:
    query_builder: components/semantic/SemanticLayerDashboard.tsx
    hooks: 
      - hooks/useSemanticQuery.ts
      - hooks/useSemanticCalc.ts  
      - hooks/useSemanticSuggest.ts
    services: services/semanticService.ts